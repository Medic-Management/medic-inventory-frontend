<div class="inventory-page">
  <h1 class="page-title">Inventario general y Alertas</h1>

  
  <div class="stats-grid">
    <div class="stat-card">
      <h3 class="stat-label blue">Categorías</h3>
      <p class="stat-value">{{ stats.totalCategories }}</p>
      <p class="stat-description">tipos de productos</p>
    </div>

    <div class="stat-card">
      <h3 class="stat-label orange">Total Medicamentos</h3>
      <p class="stat-value">{{ stats.totalUnits }}</p>
      <p class="stat-description">unidades en stock</p>
    </div>

    <div class="stat-card">
      <h3 class="stat-label purple">Productos registrados</h3>
      <p class="stat-value">{{ stats.totalMedications }}</p>
      <p class="stat-description">en el inventario</p>
    </div>

    <div class="stat-card">
      <h3 class="stat-label red">Stock crítico</h3>
      <div class="stat-split">
        <div>
          <p class="stat-value">{{ stats.criticalStock }}</p>
          <p class="stat-description">en riesgo</p>
        </div>
        <div>
          <p class="stat-value">{{ stats.outOfStock }}</p>
          <p class="stat-description">agotados</p>
        </div>
      </div>
    </div>
  </div>

  
  <div class="medications-section">
    <div class="section-header">
      <h2 class="section-title">Medicamentos</h2>
      <div class="section-actions">
        <button *ngIf="hasAccess(['JefeDeFarmacia', 'Administrador'])" class="btn btn-primary" (click)="openAddProductModal()">Agregar</button>
        <button class="btn btn-secondary" (click)="openFilterModal()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M3 3a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V3zM3 9a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V9z"/>
          </svg>
          Filtros
        </button>
        <button class="btn btn-secondary" (click)="openDownloadModal()">Descargar</button>
      </div>
    </div>

    
    <div class="table-container">
      <table class="medications-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Precio de compra</th>
            <th>Cantidad</th>
            <th>Valor de alerta</th>
            <th>Fecha de vencimiento</th>
            <th>Disponibilidad</th>
            <th *ngIf="hasAccess(['Farmaceutico', 'JefeDeFarmacia', 'Administrador'])">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (medication of paginatedMedications; track medication.id) {
            <tr>
              <td class="medication-name">{{ medication.name }}</td>
              <td>{{ medication.price }}</td>
              <td>{{ medication.quantity }} cajas</td>
              <td>{{ medication.alertValue }} cajas</td>
              <td>{{ medication.expirationDate }}</td>
              <td>
                <span
                  class="status-badge"
                  [ngClass]="medication.status"
                  [class.clickable]="medication.status === 'critical' || medication.status === 'low-stock'"
                  (click)="medication.status === 'critical' || medication.status === 'low-stock' ? openStockAlertModal(medication) : null"
                  [title]="medication.status === 'critical' || medication.status === 'low-stock' ? 'Click para solicitar reabastecimiento' : ''">
                  {{ medication.statusText }}
                </span>
              </td>
              <td *ngIf="hasAccess(['Farmaceutico', 'JefeDeFarmacia', 'Administrador'])">
                <button class="btn-action btn-dispensar" (click)="openDispensacionModal(medication)" title="Dispensar medicamento">
                  <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm1 8a1 1 0 100 2h6a1 1 0 100-2H7zm0 4a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                  </svg>
                  Dispensar
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    
    <div class="pagination">
      <button class="btn btn-outline" (click)="previousPage()" [disabled]="currentPage === 1">Anterior</button>
      <span class="pagination-info">Página {{currentPage}} de {{totalPages}}</span>
      <button class="btn btn-outline" (click)="nextPage()" [disabled]="currentPage === totalPages">Siguiente</button>
    </div>
  </div>

  
  <app-add-product-modal
    [isOpen]="isModalOpen"
    (closeModal)="closeModal()"
    (saveProduct)="onProductSaved($event)">
  </app-add-product-modal>

  
  <app-filter-modal
    [isOpen]="isFilterModalOpen"
    (closeModal)="closeFilterModal()"
    (applyFilters)="applyFilters($event)">
  </app-filter-modal>

  
  <app-download-modal
    [isOpen]="isDownloadModalOpen"
    (closeModal)="closeDownloadModal()"
    (download)="onDownload($event)">
  </app-download-modal>

  
  <app-success-modal
    [isOpen]="isSuccessModalOpen"
    [message]="successMessage"
    (closeModal)="closeSuccessModal()"
    (confirm)="closeSuccessModal()">
  </app-success-modal>

  
  <app-confirmation-modal
    [isOpen]="isConfirmationModalOpen"
    [message]="'Confirmar el envío del correo'"
    (closeModal)="closeConfirmationModal()"
    (cancel)="closeConfirmationModal()"
    (confirm)="confirmRestock()">
  </app-confirmation-modal>

  
  <app-stock-alert-modal
    [isOpen]="isAlertModalOpen"
    [alertData]="alertData"
    (closeModal)="closeAlertModal()"
    (requestRestock)="onRequestRestock($event)">
  </app-stock-alert-modal>

  
  <app-dispensacion-modal
    [isOpen]="isDispensacionModalOpen"
    [productId]="selectedProductId"
    [productName]="selectedProductName"
    (closeModal)="closeDispensacionModal()"
    (dispensationCompleted)="onDispensationCompleted()">
  </app-dispensacion-modal>
</div>
