<div class="reports-page">
  <div class="reports-grid">
    
    <div class="left-column">
      
      <div class="section-card overview-section">
        <h2 class="section-title">Resumen General</h2>

        @if (reporte) {
          <div class="metrics-grid">
            <div class="metric-item">
              <p class="metric-value">{{ formatCurrency(reporte.gananciaTotal) }}</p>
              <p class="metric-label">Ganancia Total</p>
            </div>
            <div class="metric-item">
              <p class="metric-value orange">{{ formatCurrency(reporte.ingresosTotal) }}</p>
              <p class="metric-label orange">Ingresos</p>
            </div>
            <div class="metric-item">
              <p class="metric-value purple">{{ formatCurrency(reporte.ventasTotal) }}</p>
              <p class="metric-label purple">Ventas</p>
            </div>
          </div>

          <div class="metrics-grid">
            <div class="metric-item">
              <p class="metric-value">{{ formatCurrency(reporte.valorNetoCompras) }}</p>
              <p class="metric-label">Valor neto de compras</p>
            </div>
            <div class="metric-item">
              <p class="metric-value">{{ formatCurrency(reporte.valorNetoVentas) }}</p>
              <p class="metric-label">Valor neto de ventas</p>
            </div>
            <div class="metric-item">
              <p class="metric-value">{{ formatCurrency(reporte.gananciaMensual) }}</p>
              <p class="metric-label">Ganancia mensual</p>
            </div>
            <div class="metric-item">
              <p class="metric-value">{{ formatCurrency(reporte.gananciaAnual) }}</p>
              <p class="metric-label">Ganancia anual</p>
            </div>
          </div>
        } @else {
          <p>Cargando métricas...</p>
        }
      </div>

      
      <div class="section-card chart-section">
        <div class="chart-header">
          <h2 class="section-title">Ganancias e Ingresos</h2>
          <button class="btn btn-outline-small">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M11 2v3h3v2h-3v3H9V7H6V5h3V2h2zM5 8H2v6c0 .55.45 1 1 1h1V8zm9 7c.55 0 1-.45 1-1V8h-3v7h2z"/>
            </svg>
            Semanal
          </button>
        </div>

        <div class="chart-container">
          @if (datosGrafico.length > 0) {
            
            <svg class="revenue-chart" viewBox="0 0 800 300" preserveAspectRatio="xMidYMid meet">
              
              <line x1="60" y1="250" x2="750" y2="250" stroke="#e5e7eb" stroke-width="1"/>
              <line x1="60" y1="190" x2="750" y2="190" stroke="#e5e7eb" stroke-width="1"/>
              <line x1="60" y1="130" x2="750" y2="130" stroke="#e5e7eb" stroke-width="1"/>
              <line x1="60" y1="70" x2="750" y2="70" stroke="#e5e7eb" stroke-width="1"/>

              
              <text x="20" y="254" fill="#9ca3af" font-size="12">0</text>
              <text x="20" y="194" fill="#9ca3af" font-size="12">{{ (getMaxValue() * 0.33).toFixed(0) }}</text>
              <text x="20" y="134" fill="#9ca3af" font-size="12">{{ (getMaxValue() * 0.66).toFixed(0) }}</text>
              <text x="20" y="74" fill="#9ca3af" font-size="12">{{ getMaxValue().toFixed(0) }}</text>

              
              <polyline
                [attr.points]="getLinePoints('ingresos')"
                fill="none"
                stroke="#3b82f6"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              />

              
              <polyline
                [attr.points]="getLinePoints('despachos')"
                fill="none"
                stroke="#d1d5db"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              />

              
              @for (dato of datosGrafico; track dato.mes; let i = $index) {
                <text
                  [attr.x]="80 + (i * (670 / (datosGrafico.length - 1)))"
                  y="275"
                  fill="#9ca3af"
                  font-size="12"
                  text-anchor="middle">
                  {{ dato.mes }}
                </text>
              }
            </svg>

            
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-color blue"></span>
                <span>Ingresos</span>
              </div>
              <div class="legend-item">
                <span class="legend-color gray"></span>
                <span>Despachos</span>
              </div>
            </div>
          } @else {
            <p>Cargando gráfico...</p>
          }
        </div>
      </div>

      
      <div class="section-card">
        <div class="section-header-flex">
          <h2 class="section-title">Productos más vendidos</h2>
          <a href="#" class="link-primary">Ver todo</a>
        </div>

        <table class="data-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>ID Producto</th>
              <th>Categoría</th>
              <th>Cantidad Restante</th>
              <!-- <th>Facturación</th> -->
              <th>Incremento</th>
            </tr>
          </thead>
          <tbody>
            @if (reporte && reporte.productosMasVendidos) {
              @for (product of reporte.productosMasVendidos; track product.id) {
                <tr>
                  <td class="product-name">{{ product.nombre }}</td>
                  <td>{{ product.id }}</td>
                  <td>{{ product.categoria }}</td>
                  <td>{{ product.cantidadRestante }} Unidades</td>
                  <!-- <td>{{ formatCurrency(product.facturacion) }}</td> -->
                  <td class="increase-value">{{ formatPercentage(product.porcentajeIncremento) }}</td>
                </tr>
              }
            } @else {
              <tr>
                <td colspan="5">Cargando productos...</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    
    <div class="right-column">
      
      <div class="section-card">
        <h2 class="section-title">Categorías más vendidas</h2>

        <table class="category-table">
          <thead>
            <tr>
              <th>Categoría</th>
              <!-- <th>Facturación</th> -->
              <th>Incremento</th>
            </tr>
          </thead>
          <tbody>
            @if (reporte && reporte.categoriasMasVendidas) {
              @for (category of reporte.categoriasMasVendidas; track category.nombre) {
                <tr>
                  <td>{{ category.nombre }}</td>
                  <!-- <td>{{ formatCurrency(category.facturacion) }}</td> -->
                  <td class="increase-value">{{ formatPercentage(category.porcentajeIncremento) }}</td>
                </tr>
              }
            } @else {
              <tr>
                <td colspan="2">Cargando categorías...</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
